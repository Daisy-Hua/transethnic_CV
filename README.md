# transethnic_CV

## Formula
###### loss function for EUR+AFR model:  || y1 - X1 * beta ||_2^2 +  || y - X * beta ||_2^2 
###### loss function for AFR-only model:   || y - X * beta ||_2^2 
###### penalization:  w1 || beta ||_1 + w2 || beta ||_2^2
###### w1 = lambda * alpha; w2 = lambda * (1 - alpha) / 2
###### alpha = l1_ration
### EUR summary statistics generation: 
###### A = X1'X1 = (N1 - 1) * Rhat1 
###### b = X1'y1 = (N1 - 1) * diag(Rhat1) * bhat1
### EUR+AFR model's optimization goal: 
###### argmin_beta `beta' * A * beta - 2 * b' * beta + || y - X * beta ||_2^2 + w1 || beta ||_1 + w2 || beta ||_2^2`


## step 1: Preparations for target genotype matrix and phenotype vector
Here the 012 genotype matrics for each gene on chr22 have already been prepared. 

And they are under `data/clean/+gene_name+_genotype` folder.

## step 2: Modeling and Cross validation

```
#bash
cd geuv/
./file_model.sh gene_list.txt
```

Here `file_model.sh` will process the `gene_list.txt` line by line, and pass the gene ID and its name to `model.sh`. 

Then model.sh will run `code/D_solver/CV_model.py` gene by gene and concat each gene's results into one file `result/refined.txt`.

`code/D_solver/CV_model.py` will model one gene using EUR+AFR info and only AFR info separately, and under each info, EN model and Lasso model are both trained.

The output of `code/D_solver/CV_model.py` is 

```
print(gene_name, r2_en_2, spr2_en_2,r2_lasso_2,spr2_lasso_2,r2_en_1, spr2_en_1, r2_lasso_1, spr2_lasso_1)
```

## solvers' info
EUR+AFR: yanyu's transethnic_prs.model1.Model1Blk

AFR: sklearn ElasticNetCV

## PS:
l1 ratio for EN model is 0.1, for lasso model is 1.

Also, in AFR-only model, lambda sequence is generated by yanyu's transethnic_prs.model1.Model1Helper.get_lambda_seq function, and the lambda max is determined by KKT condition when beta=0.

As for cross-validation ,the score criterion is Mean Square Errors (MSE).
